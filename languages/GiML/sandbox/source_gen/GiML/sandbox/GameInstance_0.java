package GiML.sandbox;

/*Generated by MPS */

import com.squareup.okhttp.Credentials;
import com.squareup.okhttp.MediaType;
import java.io.IOException;
import com.google.gson.JsonObject;
import com.squareup.okhttp.RequestBody;
import com.google.gson.JsonArray;
import com.squareup.okhttp.OkHttpClient;
import com.squareup.okhttp.Request;
import com.squareup.okhttp.Response;

public class GameInstance_0 {
  private static String apiGameUrl = "https://dev.smartcommunitylab.it/gamification/";
  private static String apiChallengeUrl = "https://dev.smartcommunitylab.it/gamification/model/game/";
  private static String apiIstituteUrl = "https://climbdev.smartcommunitylab.it/v2/api/institute/";
  private static String apiSchoolUrl = "https://climbdev.smartcommunitylab.it/v2/api/school/";
  private static String Token = "47094e8e-40f4-450e-abe6-44755558626f";



  private static String credentials = Credentials.basic("long-rovereto", "long_RoVg@me");
  public static final MediaType JSON = MediaType.parse("application/json; charset=utf-8");
  public GameInstance_0() throws IOException {
    run();
  }

  public void run() throws IOException {


    //  add Institute - School and Classrooms 

    JsonObject objInstitute = new JsonObject();
    // 1. Creation of the body call - json object 
    objInstitute.addProperty("address", "Via Santa Croce, 77 (TN)");
    objInstitute.addProperty("name", "FONDAZIONE BRUNO KESSLER");
    objInstitute.addProperty("objectId", "FBK_ID");
    objInstitute.addProperty("ownerId", "TEST");
    String jsonStringInstitute = objInstitute.toString();
    RequestBody bodyInstitute = RequestBody.create(JSON, jsonStringInstitute);
    this.createInstitute(bodyInstitute, "TEST");

    // create School 
    JsonObject objSchool = new JsonObject();
    // 1. Creation of the body call - json object 
    objSchool.addProperty("address", "Via Roma 45");
    objSchool.addProperty("name", "School-Models2019");
    objSchool.addProperty("objectId", "34534543");
    objSchool.addProperty("ownerId", "TEST");
    String jsonStringSchool = objSchool.toString();
    RequestBody bodySchool = RequestBody.create(JSON, jsonStringSchool);
    String instituteID = this.getInstituteID("FONDAZIONE BRUNO KESSLER");
    this.createSchool(bodySchool, "TEST", instituteID);

    // execute POST call to save the gamification Instance 
    JsonObject obj = new JsonObject();
    String gameID = "models_2019_1";
    // 1. Creation of the body call - json object 
    obj.addProperty("id", "models_2019_1");
    obj.addProperty("name", "GAME-MODELS2019");
    obj.addProperty("domain", "TEST");


    // add game points 
    JsonArray points = new JsonArray();
    // Experience Points 
    {
      JsonObject point = new JsonObject();
      point.addProperty("id", "p_id3");
      point.addProperty("name", "pedibus_trip");
      point.addProperty("score", 0);
      points.add(point);
    }
    {
      JsonObject point = new JsonObject();
      point.addProperty("id", "p_id4");
      point.addProperty("name", "bus_distance");
      point.addProperty("score", 0);
      points.add(point);
    }
    // Skill Points 
    {
      JsonObject point = new JsonObject();
      point.addProperty("id", "p_id1");
      point.addProperty("name", "absence_count");
      point.addProperty("score", 0);
      points.add(point);
    }
    {
      JsonObject point = new JsonObject();
      point.addProperty("id", "p_id2");
      point.addProperty("name", "participation_count");
      point.addProperty("score", 0);
      points.add(point);
    }

    // add Skill and Experience Points 
    obj.add("pointConcept", points);
    System.out.println("2. POINTS  ADDED");


    // add game actions 
    JsonArray actions = new JsonArray();
    // data driven actions 
    actions.add("pedibusKidTtrip");
    actions.add("classWalkTrip");
    // event driven actions 
    actions.add("calendarDayFilled");
    actions.add("studentCalendarTrip");

    obj.add("actions", actions);
    System.out.println("3. ACTIONS ADDED");


    //  add badge Collections 
    JsonArray badgeCollections = new JsonArray();

    {
      JsonObject badgeCollection = new JsonObject();
      badgeCollection.addProperty("id", "bc_1");
      badgeCollection.addProperty("name", "LegsCollection");
      JsonArray badgesEarned = new JsonArray();
      badgesEarned.add("3Legs");
      badgeCollection.add("badgeEarned", badgesEarned);

      badgesEarned.add("badgeName");
      badgeCollection.add("badgeEarned", badgesEarned);
      badgeCollections.add(badgeCollection);
    }


    obj.add("badgeCollectionConcept", badgeCollections);

    System.out.println("4. BADGE COLLECTIONS ADDED");

    //  single Player Challenges 
    {
      JsonObject challenge = new JsonObject();
      challenge.addProperty("gameId", gameID);
      challenge.addProperty("id", "ch_1");
      challenge.addProperty("name", "SchoolWithoutCar");
      JsonArray variables = new JsonArray();
      variables.add("bonusScore");
      variables.add("prizeWon");
      challenge.add("variables", variables);
      String challengeJson = challenge.toString();
      RequestBody body = RequestBody.create(JSON, challengeJson);
      doPostChallenge(body, gameID);

    }

    System.out.println("5. CHALLENGES ADDED");

    //  skill Level 
    JsonArray skillLevels = new JsonArray();

    {
      JsonObject skillLevel = new JsonObject();
      skillLevel.addProperty("name", "GoodParticipant");
      skillLevel.addProperty("pointConcept", "participation_count");
      JsonArray tresholds = new JsonArray();
      {
        JsonObject trashold = new JsonObject();
        trashold.addProperty("name", "beginner");
        trashold.addProperty("value", 5);
        tresholds.add(trashold);
      }
      skillLevel.add("thresholds", tresholds);
      skillLevels.add(skillLevel);
      String skillLevelJson = skillLevel.toString();

    }


    //  experience Level 
    JsonArray experienceLevels = new JsonArray();

    {
      JsonObject experienceLevel = new JsonObject();
      experienceLevel.addProperty("name", "GoodParticipant");
      experienceLevel.addProperty("pointConcept", "participation_count");
      JsonArray tresholds = new JsonArray();
      {
        JsonObject trashold = new JsonObject();
        trashold.addProperty("name", "beginner");
        trashold.addProperty("value", 5);
        tresholds.add(trashold);
      }
      experienceLevel.add("thresholds", tresholds);
      experienceLevels.add(experienceLevel);
      String skillLevelJson = experienceLevel.toString();

    }

    JsonArray result = new JsonArray();
    result.addAll(skillLevels);
    result.addAll(experienceLevels);
    obj.add("levels", result);
    System.out.println("6. SKILL and EXPERIENCE LEVELS ADDED");


    String jsonString = obj.toString();
    RequestBody body = RequestBody.create(JSON, jsonString);

    // execute POST call to save the gamification Instance 
    doPostNewGame(body);

  }

  public void doPostChallenge(RequestBody body, String gameID) throws IOException {
    OkHttpClient client = new OkHttpClient();
    String urlFinal = apiChallengeUrl + gameID + "/challenge";
    Request request = new Request.Builder().header("Authorization", credentials).url(urlFinal).post(body).build();
    Response response = client.newCall(request).execute();
    System.out.println("Challenges created: " + response.body().string());

  }

  public void createInstitute(RequestBody body, String ownerID) throws IOException {
    OkHttpClient client = new OkHttpClient();
    String urlFinal = apiIstituteUrl + ownerID;
    System.out.println(urlFinal);
    Request request = new Request.Builder().header("Authorization", Token).url(urlFinal).post(body).build();
    Response response = client.newCall(request).execute();
    System.out.println("Institute created: " + response.body().string());
    System.out.println("----KGG ELEMENTS CREATED------");

  }
  public void createSchool(RequestBody body, String ownerID, String instituteID) throws IOException {
    OkHttpClient client = new OkHttpClient();
    String id = instituteID.replace("\"", "");
    String urlFinal = apiSchoolUrl + ownerID + '/' + id;
    Request request = new Request.Builder().header("Authorization", Token).url(urlFinal).post(body).build();
    Response response = client.newCall(request).execute();
    System.out.println("School created: " + response.body().string());
  }

  public void doPostNewGame(RequestBody body) throws IOException {
    OkHttpClient client = new OkHttpClient();
    String urlFinal = apiGameUrl + "/model/game/";
    Request request = new Request.Builder().header("Authorization", credentials).url(urlFinal).post(body).build();
    Response response = client.newCall(request).execute();
    System.out.println("Game Creation Result: " + response.body().string());
    System.out.println("6. GAME INSTANCE CREATED");
  }

  public String getInstituteID(String instituteName) throws IOException {
    OkHttpClient client = new OkHttpClient();
    String finalUrl = apiIstituteUrl + "/TEST";
    Request request = new Request.Builder().header("Authorization", Token).url(finalUrl).build();
    Response response = client.newCall(request).execute();
    String result = response.body().string().toString();
    String result1 = result.replace("{", "");
    String result2 = result1.replace("}", "");
    String result3 = result2.replace("[", "");
    String result4 = result3.replace("]", "");

    String[] firstArray = result4.split(",");
    String[] secondArray = firstArray[1].split(":");

    String returnID = secondArray[1];
    return returnID;
  }

  public static void main(String[] arguments) throws IOException {

    System.out.println("1. GAME INSTANTIATION STARTED");
    new GameInstance_0();


  }
}
